<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSwarm Auto (Free Edition)</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f5f7fa; color: #333; line-height: 1.6; }
        .header { text-align: center; background: linear-gradient(135deg, #007bff, #00b4ff); color: white; padding: 25px 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
        .section { background: white; padding: 25px; margin-bottom: 30px; border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); }
        input[type="text"], select, input[type="number"], textarea { 
            padding: 10px; width: 100%; margin: 8px 0 15px; border: 1px solid #ddd; border-radius: 4px; 
            font-family: inherit; font-size: 15px; transition: border 0.3s;
        }
        input[type="text"]:focus, select:focus, input[type="number"]:focus, textarea:focus {
            border-color: #007bff; outline: none; box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        button { 
            padding: 12px 20px; background: linear-gradient(to right, #28a745, #20c997); color: white; 
            border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 16px;
            transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); opacity: 0.9; }
        button:active { transform: translateY(0); }
        .output-box { 
            margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px; 
            border-left: 4px solid #007bff; min-height: 200px;
        }
        .loading { color: #6c757d; font-style: italic; }
        .instructions { font-size: 15px; color: #6c757d; margin-bottom: 15px; }
        .drone-animation { 
            position: absolute; width: 50px; top: 10px; left: -50px; 
            animation: fly 3s linear forwards; display: none; 
        }
        @keyframes fly {
            0% { left: -50px; top: 10px; }
            100% { left: 90%; top: 10px; }
        }
        .lesson-section { margin-bottom: 25px; }
        .lesson-title { color: #007bff; font-size: 20px; margin-bottom: 10px; font-weight: 600; }
        .concept-box { 
            background: #e9f5ff; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #007bff;
        }
        .example-box { 
            background: #f0f8ff; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #20c997;
        }
        .practice-box { 
            background: #fff8e6; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #ffc107;
        }
        .iit-box { 
            background: #fff0f0; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #dc3545;
        }
        .simulation-box { 
            background: #f0f0ff; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #6610f2;
        }
        .tab { 
            display: inline-block; padding: 8px 15px; margin-right: 5px; 
            background: #e9ecef; border-radius: 4px 4px 0 0; cursor: pointer;
        }
        .tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .progress-container { width: 100%; background: #e9ecef; border-radius: 5px; margin: 15px 0; }
        .progress-bar { 
            height: 20px; background: linear-gradient(to right, #28a745, #20c997); 
            border-radius: 5px; text-align: center; color: white; font-weight: bold;
            line-height: 20px; transition: width 0.5s;
        }
        .formula { 
            font-family: 'Courier New', monospace; background: #f8f9fa; padding: 10px;
            border-radius: 4px; border-left: 3px solid #6c757d; margin: 10px 0;
        }
        .visual-hint { 
            background: #fff3cd; padding: 10px; border-radius: 4px; margin: 10px 0;
            border-left: 3px solid #ffc107;
        }
        .strength-highlight { color: #28a745; font-weight: bold; }
        .weakness-alert { color: #dc3545; font-weight: bold; }
        .interest-note { color: #17a2b8; font-weight: bold; }
        .learning-path { 
            background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0;
            border-left: 3px solid #6c757d;
        }
        .path-step { margin-bottom: 10px; position: relative; padding-left: 25px; }
        .path-step:before { 
            content: "→"; position: absolute; left: 5px; color: #007bff;
        }
        .path-step.completed { color: #6c757d; }
        .path-step.completed:before { content: "✓"; color: #28a745; }
        .difficulty-indicator { 
            display: inline-block; padding: 3px 8px; border-radius: 10px; 
            font-size: 12px; font-weight: bold; margin-left: 10px;
        }
        .difficulty-easy { background: #d4edda; color: #155724; }
        .difficulty-medium { background: #fff3cd; color: #856404; }
        .difficulty-hard { background: #f8d7da; color: #721c24; }
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .section { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>EduSwarm Auto (Free Edition)</h1>
        <h3>Your Personalized IIT Preparation Platform</h3>
    </div>

    <div class="container">
        <div class="section">
            <h2>Step 1: Setup Your Academic Profile</h2>
            <p class="instructions">Complete your profile to get lessons perfectly tailored to your current level and IIT goals.</p>
            
            <label for="currentClass">Current Class:</label>
            <select id="currentClass">
                <option value="6">Class 6</option>
                <option value="7">Class 7</option>
                <option value="8">Class 8</option>
                <option value="9">Class 9</option>
                <option value="10">Class 10</option>
                <option value="11">Class 11</option>
                <option value="12">Class 12</option>
            </select>
            
            <label for="currentMarks">Current Average Marks (0-100):</label>
            <input type="number" id="currentMarks" placeholder="e.g., 75" value="75" min="0" max="100">
            
            <label for="strengths">Your Strong Subjects (comma separated):</label>
            <input type="text" id="strengths" placeholder="e.g., Maths, Chemistry" value="Maths, Chemistry">
            
            <label for="weaknesses">Your Weak Subjects (comma separated):</label>
            <input type="text" id="weaknesses" placeholder="e.g., Physics, Biology" value="Physics, Biology">
            
            <label for="learningStyle">Preferred Learning Style:</label>
            <select id="learningStyle">
                <option value="visual" selected>Visual Learner (Diagrams, Charts)</option>
                <option value="auditory">Auditory Learner (Explanations, Discussions)</option>
                <option value="kinesthetic">Kinesthetic Learner (Hands-on Activities)</option>
                <option value="readwrite">Reading/Writing Learner (Textbooks, Notes)</option>
            </select>
            
            <label for="interests">Your Interests (comma separated):</label>
            <input type="text" id="interests" placeholder="e.g., Drones, Robotics, Space" value="Drones, Robotics, Space">
            
            <label for="goal">IIT Preparation Goal:</label>
            <select id="goal">
                <option value="no">No IIT Goal</option>
                <option value="basic">Basic IIT Foundation</option>
                <option value="serious" selected>Serious IIT Preparation</option>
                <option value="advanced">Advanced JEE Preparation</option>
            </select>
            
            <label for="studyTime">Daily Study Time Available:</label>
            <select id="studyTime">
                <option value="1">1 hour</option>
                <option value="2">2 hours</option>
                <option value="3" selected>3 hours</option>
                <option value="4">4 hours</option>
                <option value="5+">5+ hours</option>
            </select>
            
            <button onclick="saveProfile()">Save & Analyze Profile</button>
            
            <div id="profileAnalysis" class="output-box" style="display: none; margin-top: 20px;">
                <!-- Profile analysis will appear here -->
            </div>
        </div>

        <div class="section">
            <h2>Step 2: Select Learning Topic</h2>
            <p class="instructions">Choose a topic from your syllabus or explore advanced concepts. We'll adapt it to your level.</p>
            
            <label for="subjectSelect">Subject:</label>
            <select id="subjectSelect">
                <option value="Physics">Physics</option>
                <option value="Chemistry">Chemistry</option>
                <option value="Mathematics">Mathematics</option>
                <option value="Biology">Biology</option>
            </select>
            
            <label for="topicInput">Topic Name:</label>
            <input type="text" id="topicInput" placeholder="e.g., Motion, Thermodynamics, Algebra" value="Motion">
            
            <label for="topicDepth">Depth Level:</label>
            <select id="topicDepth">
                <option value="basic">Basic Understanding</option>
                <option value="intermediate" selected>Intermediate Level</option>
                <option value="advanced">Advanced Concepts</option>
                <option value="iit">IIT/JEE Level</option>
            </select>
            
            <button onclick="generateFullLesson()">Generate Comprehensive Lesson</button>
        </div>

        <div class="section">
            <h2>Step 3: Your Personalized Learning Experience</h2>
            <p class="instructions">Your complete lesson package will appear here with theory, examples, practice, and simulations.</p>
            
            <div class="tabs">
                <div class="tab active" onclick="switchTab('theory')">Theory</div>
                <div class="tab" onclick="switchTab('examples')">Examples</div>
                <div class="tab" onclick="switchTab('practice')">Practice</div>
                <div class="tab" onclick="switchTab('iit')">IIT Prep</div>
                <div class="tab" onclick="switchTab('simulation')">Simulation</div>
            </div>
            
            <div id="lessonOutput" class="output-box">
                <div id="theory" class="tab-content active">
                    <p>Your personalized theory lesson will appear here after generation.</p>
                </div>
                <div id="examples" class="tab-content">
                    <p>Practical examples tailored to your level will appear here.</p>
                </div>
                <div id="practice" class="tab-content">
                    <p>Practice problems matching your current ability will appear here.</p>
                </div>
                <div id="iit" class="tab-content">
                    <p>IIT/JEE preparation material will appear here if relevant.</p>
                </div>
                <div id="simulation" class="tab-content">
                    <p>Interactive simulations will appear here.</p>
                    <img src="https://cdn-icons-png.flaticon.com/512/3038/3038102.png" id="drone" class="drone-animation" alt="Drone">
                </div>
            </div>
            
            <div id="learningProgress" style="display: none; margin-top: 20px;">
                <h3>Your Learning Progress</h3>
                <div class="progress-container">
                    <div id="progressBar" class="progress-bar" style="width: 0%">0%</div>
                </div>
                <div id="progressDetails" class="learning-path"></div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Topic Database with detailed content
        const topicDatabase = {
            "Physics": {
                "6": ["Motion and Measurement", "Light, Shadows and Reflections", "Electricity and Circuits"],
                "7": ["Motion and Time", "Electric Current and its Effects", "Light"],
                "8": ["Force and Pressure", "Friction", "Sound"],
                "9": ["Motion", "Force and Laws of Motion", "Gravitation", "Work and Energy"],
                "10": ["Light - Reflection and Refraction", "Human Eye and Colourful World", "Electricity", "Magnetic Effects of Electric Current"],
                "11": ["Physical World", "Units and Measurements", "Motion in a Straight Line", "Motion in a Plane", "Laws of Motion", "Work, Energy and Power", "System of Particles and Rotational Motion", "Gravitation", "Mechanical Properties of Solids", "Mechanical Properties of Fluids", "Thermal Properties of Matter", "Thermodynamics", "Kinetic Theory", "Oscillations", "Waves", "e=mc2"],
                "12": ["Electric Charges and Fields", "Electrostatic Potential and Capacitance", "Current Electricity", "Moving Charges and Magnetism", "Magnetism and Matter", "Electromagnetic Induction", "Alternating Current", "Electromagnetic Waves", "Ray Optics and Optical Instruments", "Wave Optics", "Dual Nature of Radiation and Matter", "Atoms", "Nuclei", "Semiconductor Electronics", "Communication Systems"]
            },
            "Chemistry": {
                "6": ["Fibre to Fabric", "Sorting Materials into Groups", "Separation of Substances"],
                "7": ["Acids, Bases and Salts", "Physical and Chemical Changes", "Weather, Climate and Adaptations"],
                "8": ["Coal and Petroleum", "Combustion and Flame", "Synthetic Fibres and Plastics"],
                "9": ["Matter in Our Surroundings", "Is Matter Around Us Pure?", "Atoms and Molecules", "Structure of the Atom"],
                "10": ["Chemical Reactions and Equations", "Acids, Bases and Salts", "Metals and Non-metals", "Carbon and its Compounds"],
                "11": ["Some Basic Concepts of Chemistry", "Structure of Atom", "Classification of Elements and Periodicity in Properties", "Chemical Bonding and Molecular Structure", "States of Matter", "Thermodynamics", "Equilibrium", "Redox Reactions", "Hydrogen", "The s-Block Elements", "The p-Block Elements", "Organic Chemistry - Some Basic Principles and Techniques", "Hydrocarbons", "Environmental Chemistry"],
                "12": ["The Solid State", "Solutions", "Electrochemistry", "Chemical Kinetics", "Surface Chemistry", "General Principles and Processes of Isolation of Elements", "The p-Block Elements", "The d- and f-Block Elements", "Coordination Compounds", "Haloalkanes and Haloarenes", "Alcohols, Phenols and Ethers", "Aldehydes, Ketones and Carboxylic Acids", "Organic Compounds Containing Nitrogen", "Biomolecules", "Polymers", "Chemistry in Everyday Life"]
            },
            "Mathematics": {
                "6": ["Knowing Our Numbers", "Whole Numbers", "Playing With Numbers", "Basic Geometrical Ideas"],
                "7": ["Integers", "Fractions and Decimals", "Data Handling", "Simple Equations"],
                "8": ["Rational Numbers", "Linear Equations in One Variable", "Understanding Quadrilaterals", "Data Handling"],
                "9": ["Number Systems", "Polynomials", "Coordinate Geometry", "Linear Equations in Two Variables"],
                "10": ["Real Numbers", "Polynomials", "Pair of Linear Equations in Two Variables", "Quadratic Equations", "Arithmetic Progressions"],
                "11": ["Sets", "Relations and Functions", "Trigonometric Functions", "Principle of Mathematical Induction", "Complex Numbers and Quadratic Equations", "Linear Inequalities", "Permutations and Combinations", "Binomial Theorem", "Sequences and Series", "Straight Lines", "Conic Sections", "Introduction to Three Dimensional Geometry", "Limits and Derivatives", "Mathematical Reasoning", "Statistics", "Probability"],
                "12": ["Relations and Functions", "Inverse Trigonometric Functions", "Matrices", "Determinants", "Continuity and Differentiability", "Application of Derivatives", "Integrals", "Application of Integrals", "Differential Equations", "Vector Algebra", "Three Dimensional Geometry", "Linear Programming", "Probability"]
            }
        };

        // Detailed content for each topic by class level
        const topicContentDatabase = {
            "Physics": {
                "e=mc2": {
                    "6": {
                        "description": "A very simple introduction to energy and matter",
                        "content": "Everything around us is made of tiny particles called matter. When matter changes, it can make energy. The sun gives us light and heat energy from matter!"
                    },
                    "11": {
                        "description": "Einstein's mass-energy equivalence principle",
                        "content": "E = mc² is Einstein's famous equation showing that mass (m) can be converted into energy (E), where c is the speed of light (3×10⁸ m/s). This explains nuclear energy."
                    },
                    "12": {
                        "description": "Advanced applications in nuclear physics",
                        "content": "E = mc² underlies nuclear reactions. The mass defect in reactions converts to energy. For JEE: Calculate energy released in nuclear reactions using ΔE = Δmc²."
                    }
                },
                "Motion": {
                    "9": {
                        "description": "Basic concepts of motion in one dimension",
                        "content": "Motion is change in position over time. Speed = Distance/Time. Velocity is speed with direction. Acceleration is rate of change of velocity."
                    },
                    "11": {
                        "description": "Kinematics in one and two dimensions",
                        "content": "Motion equations: v = u + at, s = ut + ½at², v² = u² + 2as. Projectile motion has independent horizontal (constant velocity) and vertical (acceleration g) components."
                    }
                },
                "Gravitation": {
                    "9": {
                        "description": "Basic concepts of gravitational force",
                        "content": "Gravity is the force that attracts objects with mass. On Earth, it gives objects weight. The acceleration due to gravity (g) is about 9.8 m/s²."
                    },
                    "11": {
                        "description": "Newton's law of universal gravitation",
                        "content": "F = G(m₁m₂)/r², where G is gravitational constant. Explains planetary motion, tides, and weight variation."
                    }
                }
            },
            "Mathematics": {
                "Algebra": {
                    "6": {
                        "description": "Introduction to basic algebraic concepts",
                        "content": "Algebra uses letters to represent numbers. Simple equations like x + 3 = 7 can be solved to find x = 4."
                    },
                    "10": {
                        "description": "Quadratic equations and polynomials",
                        "content": "Quadratic equations: ax² + bx + c = 0. Solutions: x = [-b ± √(b²-4ac)]/2a. Polynomials have degrees based on highest power."
                    }
                }
            }
        };

        // Save profile and show analysis
        function saveProfile() {
            const marks = parseInt(document.getElementById("currentMarks").value);
            if (marks < 0 || marks > 100) {
                alert("Please enter valid marks between 0 and 100!");
                return;
            }
            
            const profile = {
                currentClass: document.getElementById("currentClass").value,
                currentMarks: marks,
                strengths: document.getElementById("strengths").value.split(',').map(s => s.trim()),
                weaknesses: document.getElementById("weaknesses").value.split(',').map(s => s.trim()),
                learningStyle: document.getElementById("learningStyle").value,
                interests: document.getElementById("interests").value.split(',').map(s => s.trim()),
                goal: document.getElementById("goal").value,
                studyTime: document.getElementById("studyTime").value
            };
            
            localStorage.setItem("studentProfile", JSON.stringify(profile));
            analyzeProfile(profile);
        }

        // Analyze profile and show recommendations
        function analyzeProfile(profile) {
            const analysisDiv = document.getElementById("profileAnalysis");
            analysisDiv.style.display = "block";
            
            let analysisHTML = `<h3>Your Academic Profile Analysis</h3>`;
            
            // Class and marks analysis
            analysisHTML += `<div class="concept-box">
                <h4>Current Level Analysis</h4>
                <p>You're in <strong>Class ${profile.currentClass}</strong> with average marks of <strong>${profile.currentMarks}%</strong>.</p>`;
            
            if (profile.currentMarks < 40) {
                analysisHTML += `<p class="weakness-alert">Your marks indicate you need to strengthen fundamental concepts before advancing.</p>`;
            } else if (profile.currentMarks < 70) {
                analysisHTML += `<p>You have a decent understanding but should focus on improving weak areas.</p>`;
            } else if (profile.currentMarks < 85) {
                analysisHTML += `<p>You're performing well! Now focus on advanced applications and problem-solving.</p>`;
            } else {
                analysisHTML += `<p class="strength-highlight">Excellent performance! You're ready for challenging material and IIT-level problems.</p>`;
            }
            
            analysisHTML += `</div>`;
            
            // Strengths and weaknesses analysis
            analysisHTML += `<div class="concept-box">
                <h4>Subject Analysis</h4>
                <p><span class="strength-highlight">Strengths:</span> ${profile.strengths.join(', ')}</p>
                <p><span class="weakness-alert">Weaknesses:</span> ${profile.weaknesses.join(', ')}</p>`;
            
            if (profile.weaknesses.some(w => ["Physics", "Mathematics"].includes(w))) {
                analysisHTML += `<p class="weakness-alert">Since you're weak in ${profile.weaknesses.filter(w => ["Physics", "Mathematics"].includes(w)).join(' or ')}, 
                we'll focus on building strong fundamentals before advancing to IIT-level concepts.</p>`;
            }
            
            analysisHTML += `</div>`;
            
            // Learning style adaptation
            analysisHTML += `<div class="concept-box">
                <h4>Learning Style Adaptation</h4>`;
            
            if (profile.learningStyle === "visual") {
                analysisHTML += `<p>As a <strong>visual learner</strong>, your lessons will include:
                <ul>
                    <li>Diagrams and infographics</li>
                    <li>Color-coded concepts</li>
                    <li>Visual memory techniques</li>
                    <li>Video explanations</li>
                </ul></p>`;
            } else if (profile.learningStyle === "auditory") {
                analysisHTML += `<p>As an <strong>auditory learner</strong>, your lessons will include:
                <ul>
                    <li>Detailed verbal explanations</li>
                    <li>Mnemonics and rhymes</li>
                    <li>Discussion prompts</li>
                    <li>Audio summaries</li>
                </ul></p>`;
            } else if (profile.learningStyle === "kinesthetic") {
                analysisHTML += `<p>As a <strong>kinesthetic learner</strong>, your lessons will include:
                <ul>
                    <li>Hands-on activities</li>
                    <li>Physical analogies</li>
                    <li>Interactive simulations</li>
                    <li>Real-world applications</li>
                </ul></p>`;
            } else {
                analysisHTML += `<p>As a <strong>reading/writing learner</strong>, your lessons will include:
                <ul>
                    <li>Detailed notes</li>
                    <li>Textbook-style explanations</li>
                    <li>Writing exercises</li>
                    <li>Reading assignments</li>
                </ul></p>`;
            }
            
            analysisHTML += `</div>`;
            
            // IIT preparation roadmap
            if (profile.goal !== "no") {
                analysisHTML += `<div class="iit-box">
                    <h4>IIT/JEE Preparation Roadmap</h4>`;
                
                if (profile.currentClass <= 8) {
                    analysisHTML += `<p>Since you're in Class ${profile.currentClass}, we'll focus on:
                    <ul>
                        <li>Building strong fundamentals in Math and Science</li>
                        <li>Developing logical thinking and problem-solving skills</li>
                        <li>Introducing basic Olympiad-level concepts</li>
                        <li>Cultivating scientific curiosity</li>
                    </ul></p>`;
                } else if (profile.currentClass <= 10) {
                    analysisHTML += `<p>For Class ${profile.currentClass} IIT aspirants:
                    <ul>
                        <li>Complete CBSE/State syllabus with deep conceptual understanding</li>
                        <li>Start basic JEE-level problem solving</li>
                        <li>Develop time management skills</li>
                        <li>Begin regular practice with mock tests</li>
                    </ul></p>`;
                } else {
                    analysisHTML += `<p>For Class ${profile.currentClass} JEE preparation:
                    <ul>
                        <li>Full JEE syllabus coverage with advanced concepts</li>
                        <li>Daily problem-solving practice</li>
                        <li>Mock test analysis and strategy development</li>
                        <li>Time-bound practice sessions</li>
                    </ul></p>`;
                }
                
                analysisHTML += `<p>Based on your ${profile.studyTime} hours daily study time, we'll create a customized schedule.</p>`;
                analysisHTML += `</div>`;
            }
            
            // Interest integration
            if (profile.interests.length > 0) {
                analysisHTML += `<div class="example-box">
                    <h4>Interest Integration</h4>
                    <p>We'll connect concepts to your interests in <span class="interest-note">${profile.interests.join(', ')}</span> to make learning more engaging.</p>
                    <p>For example, when studying Physics concepts, we'll show applications in drone technology.</p>
                </div>`;
            }
            
            analysisHTML += `<button onclick="generateStudyPlan()">Generate Personalized Study Plan</button>`;
            analysisDiv.innerHTML = analysisHTML;
        }

        // Generate study plan based on profile
        function generateStudyPlan() {
            const profile = JSON.parse(localStorage.getItem("studentProfile"));
            const studyPlanDiv = document.getElementById("profileAnalysis");
            
            let planHTML = `<h3>Your Personalized Study Plan</h3>
            <div class="learning-path">`;
            
            // Generate path based on class and goals
            if (profile.currentClass <= 8) {
                planHTML += `<h4>Foundation Building Phase (Class 6-8)</h4>
                <div class="path-step">Master basic concepts in Math and Science</div>
                <div class="path-step">Develop problem-solving approach</div>
                <div class="path-step">Participate in Olympiads and quizzes</div>`;
                
                if (profile.goal !== "no") {
                    planHTML += `<div class="path-step">Start introductory JEE concepts</div>`;
                }
            } else if (profile.currentClass <= 10) {
                planHTML += `<h4>Preparatory Phase (Class 9-10)</h4>
                <div class="path-step">Complete school syllabus with 90%+ marks</div>
                <div class="path-step">Build strong fundamentals in Physics, Chemistry, Math</div>
                <div class="path-step">Start basic JEE-level problems</div>`;
                
                if (profile.goal === "serious" || profile.goal === "advanced") {
                    planHTML += `<div class="path-step">Begin NCERT + JEE Foundation books</div>
                    <div class="path-step">Weekly mock tests for speed and accuracy</div>`;
                }
            } else {
                planHTML += `<h4>JEE Preparation Phase (Class 11-12)</h4>
                <div class="path-step">Complete JEE syllabus systematically</div>
                <div class="path-step">Daily problem-solving practice (${profile.studyTime} hours/day)</div>
                <div class="path-step">Weekly full-length mock tests</div>
                <div class="path-step">Weakness analysis and improvement</div>`;
                
                if (profile.goal === "advanced") {
                    planHTML += `<div class="path-step">Advanced problem-solving techniques</div>
                    <div class="path-step">JEE Advanced level practice</div>`;
                }
            }
            
            // Add subject-specific paths for weaknesses
            if (profile.weaknesses.includes("Physics")) {
                planHTML += `<h4>Physics Improvement Path</h4>
                <div class="path-step">Conceptual understanding through visualizations</div>
                <div class="path-step">Daily numerical problem practice</div>
                <div class="path-step">Application-based learning</div>`;
            }
            
            if (profile.weaknesses.includes("Mathematics")) {
                planHTML += `<h4>Math Improvement Path</h4>
                <div class="path-step">Clear all fundamental concepts</div>
                <div class="path-step">Formula derivation and application</div>
                <div class="path-step">Problem-solving speed drills</div>`;
            }
            
            planHTML += `</div>
            <div class="progress-container">
                <div class="progress-bar" style="width: 5%">5%</div>
            </div>
            <p>Start your journey by selecting a topic below!</p>`;
            
            studyPlanDiv.innerHTML += planHTML;
        }

        // Switch between lesson tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activate selected tab
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Generate comprehensive lesson
        async function generateFullLesson() {
            const topic = document.getElementById("topicInput").value || "Motion";
            const subject = document.getElementById("subjectSelect").value;
            const depth = document.getElementById("topicDepth").value;
            const profile = JSON.parse(localStorage.getItem("studentProfile")) || {
                currentClass: "11",
                currentMarks: 75,
                strengths: ["Maths"],
                weaknesses: ["Physics"],
                learningStyle: "visual",
                interests: ["Drones"],
                goal: "serious",
                studyTime: "3"
            };
            
            // Show loading state
            document.getElementById('theory').innerHTML = "<p>Generating personalized lesson... <span class='loading'>This may take a moment</span></p>";
            document.getElementById('examples').innerHTML = "<p>Preparing examples tailored to your level...</p>";
            document.getElementById('practice').innerHTML = "<p>Creating practice problems...</p>";
            document.getElementById('iit').innerHTML = "<p>Compiling IIT preparation material...</p>";
            document.getElementById('simulation').innerHTML = "<p>Initializing simulation...</p>";
            
            // Show learning progress
            document.getElementById('learningProgress').style.display = 'block';
            updateProgressBar(10);
            
            // Generate theory content
            setTimeout(async () => {
                const theoryContent = await generateTheoryContent(topic, subject, depth, profile);
                document.getElementById('theory').innerHTML = theoryContent;
                updateProgressBar(30);
                
                // Generate examples
                setTimeout(() => {
                    const examplesContent = generateExamplesContent(topic, subject, depth, profile);
                    document.getElementById('examples').innerHTML = examplesContent;
                    updateProgressBar(50);
                    
                    // Generate practice problems
                    setTimeout(() => {
                        const practiceContent = generatePracticeContent(topic, subject, depth, profile);
                        document.getElementById('practice').innerHTML = practiceContent;
                        updateProgressBar(70);
                        
                        // Generate IIT prep
                        setTimeout(() => {
                            const iitContent = generateIITContent(topic, subject, depth, profile);
                            document.getElementById('iit').innerHTML = iitContent;
                            updateProgressBar(90);
                            
                            // Generate simulation
                            setTimeout(() => {
                                const simulationContent = generateSimulationContent(topic, subject, depth, profile);
                                document.getElementById('simulation').innerHTML = simulationContent;
                                updateProgressBar(100);
                                
                                // Show drone animation only for relevant topics
                                if (shouldShowDrone(topic, subject)) {
                                    const drone = document.getElementById("drone");
                                    drone.style.display = "block";
                                    setTimeout(() => { 
                                        drone.style.display = "none";
                                    }, 3000);
                                }
                            }, 1000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 1500);
        }

        // Check if drone example should be shown for this topic
        function shouldShowDrone(topic, subject) {
            const droneRelevantTopics = ["Motion", "Gravitation", "Force", "Energy", "e=mc2"];
            return subject === "Physics" && droneRelevantTopics.includes(topic);
        }

        // Update progress bar
        function updateProgressBar(percent) {
            const bar = document.getElementById('progressBar');
            bar.style.width = percent + '%';
            bar.textContent = percent + '%';
            
            // Update path steps
            const path = document.getElementById('progressDetails');
            if (percent >= 10) path.innerHTML = `<div class="path-step completed">Lesson analysis completed</div>`;
            if (percent >= 30) path.innerHTML += `<div class="path-step completed">Theory content generated</div>`;
            if (percent >= 50) path.innerHTML += `<div class="path-step completed">Examples prepared</div>`;
            if (percent >= 70) path.innerHTML += `<div class="path-step completed">Practice problems created</div>`;
            if (percent >= 90) path.innerHTML += `<div class="path-step completed">IIT material compiled</div>`;
            if (percent >= 100) path.innerHTML += `<div class="path-step completed">Simulation ready</div>`;
        }

        // Generate detailed theory content
        async function generateTheoryContent(topic, subject, depth, profile) {
            let content = `<div class="lesson-section">
                <h2 class="lesson-title">${topic} - Theory</h2>
                <div class="concept-box">
                    <h3>Concept Introduction</h3>`;
            
            // Get basic description based on class
            const classLevel = profile.currentClass;
            let description = "", detailedContent = "";
            
            if (topicContentDatabase[subject] && topicContentDatabase[subject][topic] && 
                topicContentDatabase[subject][topic][classLevel]) {
                description = topicContentDatabase[subject][topic][classLevel].description;
                detailedContent = topicContentDatabase[subject][topic][classLevel].content;
            } else {
                // Fallback generic description
                description = `Fundamentals of ${topic}`;
                detailedContent = `${topic} is an important concept in ${subject}. Let's explore its key aspects.`;
            }
            
            content += `<p><strong>${description}</strong></p>`;
            
            // Add content based on learning style
            if (profile.learningStyle === "visual") {
                content += `<div class="visual-hint">
                    <p>🖼️ <strong>Visual Tip:</strong> Imagine ${topic} as a drone flying through concepts!</p>
                </div>`;
            } else if (profile.learningStyle === "auditory") {
                content += `<div class="visual-hint">
                    <p>🎧 <strong>Auditory Tip:</strong> Try explaining ${topic} out loud to yourself.</p>
                </div>`;
            } else if (profile.learningStyle === "kinesthetic") {
                content += `<div class="visual-hint">
                    <p>✋ <strong>Kinesthetic Tip:</strong> Use hand motions to represent ${topic} concepts.</p>
                </div>`;
            }
            
            content += `<p>${detailedContent}</p>`;
            
            // Add difficulty indicator
            let difficulty = "";
            if (profile.currentMarks < 50) {
                difficulty = `<span class="difficulty-indicator difficulty-hard">Challenging</span>`;
            } else if (profile.currentMarks < 70) {
                difficulty = `<span class="difficulty-indicator difficulty-medium">Moderate</span>`;
            } else {
                difficulty = `<span class="difficulty-indicator difficulty-easy">Easy</span>`;
            }
            
            content += `<p>Current difficulty level for you: ${difficulty}</p>`;
            
            // Add formulas if relevant
            if (topic === "e=mc2") {
                content += `<div class="formula">
                    <p>The mass-energy equivalence formula:</p>
                    <p>E = mc²</p>
                    <p>Where:<br>
                    E = Energy (Joules)<br>
                    m = Mass (kg)<br>
                    c = Speed of light (3×10⁸ m/s)</p>
                </div>`;
            } else if (topic === "Motion") {
                content += `<div class="formula">
                    <p>Basic motion equations:</p>
                    <p>v = u + at</p>
                    <p>s = ut + ½at²</p>
                    <p>v² = u² + 2as</p>
                    <p>Where:<br>
                    u = Initial velocity<br>
                    v = Final velocity<br>
                    a = Acceleration<br>
                    t = Time<br>
                    s = Displacement</p>
                </div>`;
            } else if (topic === "Gravitation") {
                content += `<div class="formula">
                    <p>Newton's law of gravitation:</p>
                    <p>F = G(m₁m₂)/r²</p>
                    <p>Where:<br>
                    F = Gravitational force<br>
                    G = Gravitational constant (6.674×10⁻¹¹ N·m²/kg²)<br>
                    m₁, m₂ = Masses of objects<br>
                    r = Distance between centers</p>
                </div>`;
            }
            
            content += `</div>`; // Close concept-box
            
            // Add detailed explanation based on marks and depth
            content += `<div class="concept-box">
                <h3>Detailed Explanation</h3>`;
            
            if (depth === "basic") {
                content += `<p>Let's understand ${topic} at a basic level:</p>`;
                
                if (topic === "e=mc2") {
                    content += `<p>Everything has energy, even when it's not moving. Einstein discovered that mass (the "stuff" things are made of) 
                    can turn into energy. The equation E = mc² tells us how much energy we can get from mass.</p>
                    <p>Example: A tiny amount of mass can make a huge amount of energy because c (speed of light) is very big, and we square it!</p>`;
                } else if (topic === "Motion") {
                    content += `<p>Motion is about how things move. We describe motion using:</p>
                    <ul>
                        <li>Position: Where something is</li>
                        <li>Velocity: How fast and in what direction it's moving</li>
                        <li>Acceleration: How quickly velocity is changing</li>
                    </ul>`;
                } else if (topic === "Gravitation") {
                    content += `<p>Gravity is the force that pulls objects together. On Earth, it makes things fall toward the ground.</p>
                    <p>Key points:</p>
                    <ul>
                        <li>All objects with mass have gravity</li>
                        <li>More mass = stronger gravity</li>
                        <li>Farther apart = weaker gravity</li>
                    </ul>`;
                }
            } else if (depth === "intermediate") {
                content += `<p>Now let's dive deeper into ${topic}:</p>`;
                
                if (topic === "e=mc2") {
                    content += `<p>E = mc² comes from Einstein's theory of relativity. It shows that mass and energy are interchangeable. In nuclear reactions, 
                    a small amount of mass is converted to a large amount of energy because c² is a huge number (9×10¹⁶ m²/s²).</p>
                    <p>This explains why nuclear power plants and atomic bombs release so much energy from small amounts of fuel.</p>`;
                } else if (topic === "Motion") {
                    content += `<p>In physics, we use equations to precisely describe motion:</p>
                    <ul>
                        <li>Velocity is the rate of change of position</li>
                        <li>Acceleration is the rate of change of velocity</li>
                        <li>These changes can be represented graphically (position-time, velocity-time graphs)</li>
                    </ul>`;
                } else if (topic === "Gravitation") {
                    content += `<p>Newton's law explains how all masses attract each other. The force depends on:</p>
                    <ul>
                        <li>The product of the two masses</li>
                        <li>The inverse square of the distance between them</li>
                        <li>Gravitational constant G</li>
                    </ul>`;
                }
            } else { // advanced or iit
                content += `<p>Advanced understanding of ${topic}:</p>`;
                
                if (topic === "e=mc2") {
                    content += `<p>The full energy-momentum relation is E² = (pc)² + (mc²)², where p is momentum. E = mc² is the rest energy case (p=0).</p>
                    <p>This equation is fundamental in particle physics. When particles collide at high speeds, their kinetic energy can convert 
                    to new particles via E = mc².</p>
                    <p>In nuclear reactions, the mass defect (difference between initial and final mass) converts to energy via ΔE = Δmc².</p>`;
                } else if (topic === "Motion") {
                    content += `<p>Advanced motion concepts include:</p>
                    <ul>
                        <li>Vector analysis of motion in 2D and 3D</li>
                        <li>Calculus-based definitions: v = ds/dt, a = dv/dt</li>
                        <li>Relative motion between reference frames</li>
                        <li>Non-uniform acceleration cases</li>
                    </ul>`;
                } else if (topic === "Gravitation") {
                    content += `<p>Advanced gravitation concepts:</p>
                    <ul>
                        <li>Gravitational potential energy</li>
                        <li>Kepler's laws of planetary motion</li>
                        <li>Escape velocity calculations</li>
                        <li>Introduction to Einstein's general relativity</li>
                    </ul>`;
                }
            }
            
            // Add interest connection if relevant
            if (profile.interests.includes("Drones") && shouldShowDrone(topic, subject)) {
                content += `<div class="example-box">
                    <h4>Drone Connection</h4>
                    <p>Drones use ${topic} concepts:</p>`;
                
                if (topic === "Motion") {
                    content += `<ul>
                        <li>Motion equations help calculate flight paths</li>
                        <li>Acceleration determines how quickly drones can change speed/direction</li>
                        <li>Position tracking is essential for GPS navigation</li>
                    </ul>`;
                } else if (topic === "e=mc2") {
                    content += `<ul>
                        <li>Battery energy is related to mass via E = mc² (though chemical energy is different)</li>
                        <li>Nuclear-powered drones (theoretical) would directly apply this equation</li>
                        <li>Energy-mass considerations affect payload capacity</li>
                    </ul>`;
                } else if (topic === "Gravitation") {
                    content += `<ul>
                        <li>Drones must overcome gravity to fly</li>
                        <li>Thrust must exceed gravitational force for takeoff</li>
                        <li>Gravity affects battery usage and flight time</li>
                    </ul>`;
                }
                
                content += `</div>`;
            }
            
            content += `</div>`; // Close concept-box
            
            // Add web info if available
            if (navigator.onLine) {
                try {
                    const webInfo = await fetchTopicInfo(topic);
                    content += `<div class="concept-box">
                        <h3>Additional Information</h3>
                        <p>${webInfo}</p>
                    </div>`;
                } catch (e) {
                    console.log("Couldn't fetch web info");
                }
            }
            
            content += `</div>`; // Close lesson-section
            return content;
        }

        // Generate examples content
        function generateExamplesContent(topic, subject, depth, profile) {
            let content = `<div class="lesson-section">
                <h2 class="lesson-title">${topic} - Examples</h2>
                <div class="example-box">
                    <h3>Practical Examples</h3>`;
            
            if (topic === "e=mc2") {
                content += `<p><strong>Example 1:</strong> Calculate energy equivalent of 1 gram of mass</p>
                <p>m = 1g = 0.001kg, c = 3×10⁸ m/s</p>
                <p>E = mc² = 0.001 × (3×10⁸)² = 9×10¹³ J</p>
                <p>This is equivalent to about 21 kilotons of TNT - similar to the atomic bomb dropped on Nagasaki!</p>`;
                
                if (depth === "intermediate" || depth === "advanced" || depth === "iit") {
                    content += `<p><strong>Example 2:</strong> Sun's energy production</p>
                    <p>The sun converts 4 million tons of mass to energy each second via E = mc²</p>
                    <p>This powers all life on Earth through sunlight!</p>`;
                }
                
                if (depth === "iit") {
                    content += `<p><strong>JEE Example:</strong> Mass defect in nuclear reactions</p>
                    <p>When a Uranium-235 nucleus splits, the products have slightly less mass than the original. 
                    This missing mass (Δm) becomes energy via E = Δmc².</p>
                    <p>Calculate energy released when 1g of U-235 undergoes fission (Δm = 0.1% of mass).</p>
                    <p>Solution: Δm = 0.001g = 10⁻⁶kg, E = 10⁻⁶ × (3×10⁸)² = 9×10¹⁰ J</p>`;
                }
            } else if (topic === "Motion") {
                content += `<p><strong>Example 1:</strong> Car accelerating from rest</p>
                <p>A car accelerates at 2 m/s² for 5 seconds from rest. Calculate final velocity and distance covered.</p>
                <p>v = u + at = 0 + 2×5 = 10 m/s</p>
                <p>s = ut + ½at² = 0 + ½×2×25 = 25 m</p>`;
                
                if (depth === "intermediate" || depth === "advanced" || depth === "iit") {
                    content += `<p><strong>Example 2:</strong> Projectile motion</p>
                    <p>A ball is thrown at 20 m/s at 30° angle. Calculate maximum height and range.</p>
                    <p>Vertical component: u_y = 20×sin30° = 10 m/s</p>
                    <p>Time to peak: t = u_y/g = 10/9.8 ≈ 1.02 s</p>
                    <p>Max height: h = u_y t - ½gt² ≈ 10×1.02 - 4.9×1.04 ≈ 5.1 m</p>`;
                }
                
                if (depth === "iit") {
                    content += `<p><strong>JEE Example:</strong> Relative motion</p>
                    <p>Two trains approach each other at 30 m/s and 20 m/s. When they're 2 km apart, 
                    a bird flies from one train to other at 50 m/s, repeating until trains meet. 
                    Calculate total distance bird flies.</p>
                    <p>Solution: Time until collision = 2000/(30+20) = 40 s</p>
                    <p>Bird distance = speed × time = 50 × 40 = 2000 m</p>`;
                }
            } else if (topic === "Gravitation") {
                content += `<p><strong>Example 1:</strong> Earth's gravitational force</p>
                <p>Calculate force between Earth (5.97×10²⁴ kg) and 1kg object at surface (radius 6.371×10⁶ m)</p>
                <p>F = G(m₁m₂)/r² = (6.674×10⁻¹¹)(5.97×10²⁴)(1)/(6.371×10⁶)² ≈ 9.81 N (which we know as weight)</p>`;
                
                if (depth === "intermediate" || depth === "advanced" || depth === "iit") {
                    content += `<p><strong>Example 2:</strong> Gravitational force between people</p>
                    <p>Two 70kg people stand 1m apart. Calculate gravitational attraction.</p>
                    <p>F = (6.674×10⁻¹¹)(70)(70)/1² ≈ 3.27×10⁻⁷ N (extremely small!)</p>`;
                }
            }
            
            // Add interest-based examples if relevant
            if (profile.interests.includes("Drones") && shouldShowDrone(topic, subject)) {
                content += `<div class="example-box">
                    <h4>Drone Examples</h4>`;
                
                if (topic === "Motion") {
                    content += `<p><strong>Drone Example:</strong> A drone accelerates upward at 3 m/s² carrying a package. 
                    Calculate tension in cables if drone mass is 2kg and package is 0.5kg.</p>
                    <p>Total mass = 2.5kg, upward force needed = m(g+a) = 2.5×(9.8+3) = 32 N</p>`;
                } else if (topic === "e=mc2") {
                    content += `<p><strong>Drone Example:</strong> A drone battery stores 100Wh of energy. 
                    Calculate equivalent mass using E = mc².</p>
                    <p>100 Wh = 360,000 J</p>
                    <p>m = E/c² = 360,000/(9×10¹⁶) ≈ 4×10⁻¹² kg (extremely small!)</p>`;
                } else if (topic === "Gravitation") {
                    content += `<p><strong>Drone Example:</strong> A drone weighs 1.5kg. Calculate the thrust needed to hover.</p>
                    <p>Thrust must equal weight = mg = 1.5×9.8 = 14.7 N</p>`;
                }
                
                content += `</div>`;
            }
            
            content += `</div></div>`; // Close example-box and lesson-section
            return content;
        }

        // Generate practice content
        function generatePracticeContent(topic, subject, depth, profile) {
            let content = `<div class="lesson-section">
                <h2 class="lesson-title">${topic} - Practice</h2>
                <div class="practice-box">
                    <h3>Practice Problems</h3>
                    <p>Solve these problems to test your understanding:</p>`;
            
            if (topic === "e=mc2") {
                if (profile.currentMarks < 50) {
                    content += `<p><strong>Basic:</strong> If c = 3×10⁸ m/s, what is c²?</p>
                    <p><strong>Basic:</strong> How much energy (E) comes from 2 kg of mass?</p>`;
                } else if (profile.currentMarks < 70) {
                    content += `<p><strong>Intermediate:</strong> Calculate energy equivalent of 0.5g of mass.</p>
                    <p><strong>Intermediate:</strong> If 1g of mass is converted to energy, how many 100W bulbs could it power for a year?</p>`;
                } else {
                    content += `<p><strong>Advanced:</strong> The sun loses 4 million tons of mass per second. Calculate its power output.</p>
                    <p><strong>Advanced:</strong> In a nuclear reaction, 0.1% of mass is converted to energy. For 1kg of fuel, calculate energy released.</p>`;
                }
                
                if (depth === "iit") {
                    content += `<p><strong>JEE Level:</strong> A particle of mass m decays into two photons. Using E = mc² and momentum conservation, 
                    calculate the energy of each photon if they move in opposite directions.</p>`;
                }
            } else if (topic === "Motion") {
                if (profile.currentMarks < 50) {
                    content += `<p><strong>Basic:</strong> A car moves at 20 m/s for 5s. What distance does it cover?</p>
                    <p><strong>Basic:</strong> An object accelerates from 0 to 10 m/s in 2s. What is its acceleration?</p>`;
                } else if (profile.currentMarks < 70) {
                    content += `<p><strong>Intermediate:</strong> A train decelerates from 30 m/s to 10 m/s over 100m. Calculate deceleration and time taken.</p>
                    <p><strong>Intermediate:</strong> A ball is thrown upward at 20 m/s. Calculate maximum height and time to return.</p>`;
                } else {
                    content += `<p><strong>Advanced:</strong> Two cars start 100m apart, one accelerating at 2 m/s², the other at 3 m/s². 
                    When and where do they meet if they start moving toward each other simultaneously?</p>
                    <p><strong>Advanced:</strong> A particle moves along x-axis with velocity v = 3t² - 2t. Find acceleration at t=2s and displacement from t=0 to t=3s.</p>`;
                }
                
                if (depth === "iit") {
                    content += `<p><strong>JEE Level:</strong> A particle is projected from ground with speed u at angle θ. Show that at any time t, 
                    its velocity is perpendicular to initial velocity when t = 2u/(g sinθ).</p>`;
                }
            } else if (topic === "Gravitation") {
                if (profile.currentMarks < 50) {
                    content += `<p><strong>Basic:</strong> Calculate your weight on Earth (mass × g).</p>
                    <p><strong>Basic:</strong> If you could jump 0.5m on Earth, how high could you jump on the Moon (g = 1.62 m/s²)?</p>`;
                } else if (profile.currentMarks < 70) {
                    content += `<p><strong>Intermediate:</strong> Calculate gravitational force between Earth and Moon (mass 7.34×10²² kg, distance 3.84×10⁸ m).</p>
                    <p><strong>Intermediate:</strong> At what height above Earth's surface would gravity be half its surface value?</p>`;
                } else {
                    content += `<p><strong>Advanced:</strong> Calculate escape velocity from Earth's surface.</p>
                    <p><strong>Advanced:</strong> A satellite orbits Earth at height h. Derive expression for its orbital velocity.</p>`;
                }
            }
            
            // Add interest-based practice problems if relevant
            if (profile.interests.includes("Drones") && shouldShowDrone(topic, subject)) {
                content += `<div class="practice-box">
                    <h4>Drone Practice</h4>`;
                
                if (topic === "Motion") {
                    content += `<p><strong>Problem:</strong> A drone ascends at 2 m/s² for 4s, then hovers for 3s, then descends at 1 m/s² until landing. 
                    Calculate maximum height reached and total flight time.</p>`;
                } else if (topic === "e=mc2") {
                    content += `<p><strong>Problem:</strong> A drone battery stores 200Wh of energy. If this energy could be converted to mass, 
                    how much mass would it create? (Use E = mc²)</p>`;
                } else if (topic === "Gravitation") {
                    content += `<p><strong>Problem:</strong> A drone has mass 1.2kg. Calculate the additional energy needed to climb 50m against gravity.</p>`;
                }
                
                content += `</div>`;
            }
            
            content += `</div>
                <div class="practice-box">
                    <h3>Solutions</h3>
                    <p>Think through the problems before checking solutions:</p>`;
            
            if (topic === "e=mc2") {
                content += `<p><strong>Basic Solutions:</strong></p>
                <p>1. c² = (3×10⁸)² = 9×10¹⁶ m²/s²</p>
                <p>2. E = 2 × (3×10⁸)² = 1.8×10¹⁷ J</p>`;
                
                if (profile.currentMarks >= 50) {
                    content += `<p><strong>Intermediate Solutions:</strong></p>
                    <p>1. E = 0.0005 × (3×10⁸)² = 4.5×10¹³ J</p>
                    <p>2. E = 0.001 × (3×10⁸)² = 9×10¹³ J</p>
                    <p>   Seconds in year ≈ 3.15×10⁷, so bulbs = 9×10¹³/(100×3.15×10⁷) ≈ 28,500 bulbs</p>`;
                }
                
                if (profile.currentMarks >= 70) {
                    content += `<p><strong>Advanced Solutions:</strong></p>
                    <p>1. 4×10⁹ kg/s × (3×10⁸)² = 3.6×10²⁶ W</p>
                    <p>2. Δm = 0.001 × 1kg, E = 0.001 × (3×10⁸)² = 9×10¹³ J</p>`;
                }
            } else if (topic === "Motion") {
                content += `<p><strong>Basic Solutions:</strong></p>
                <p>1. Distance = speed × time = 20 × 5 = 100 m</p>
                <p>2. Acceleration = Δv/Δt = (10-0)/2 = 5 m/s²</p>`;
                
                if (profile.currentMarks >= 50) {
                    content += `<p><strong>Intermediate Solutions:</strong></p>
                    <p>1. v² = u² + 2as ⇒ 100 = 900 + 200a ⇒ a = -4 m/s²</p>
                    <p>   t = (v-u)/a = (10-30)/-4 = 5s</p>
                    <p>2. At max height, v = 0. t = u/g = 20/9.8 ≈ 2.04s</p>
                    <p>   h = ut - ½gt² ≈ 20×2.04 - 4.9×4.16 ≈ 20.4m</p>
                    <p>   Total time = 2×2.04 ≈ 4.08s</p>`;
                }
            } else if (topic === "Gravitation") {
                content += `<p><strong>Basic Solutions:</strong></p>
                <p>1. Weight = mass × g (e.g., 60kg × 9.8 = 588 N)</p>
                <p>2. On Moon: h = (v²)/(2g_moon) = (2g_earth×0.5)/(2g_moon) = (9.8×0.5)/1.62 ≈ 3.02m</p>`;
            }
            
            content += `</div></div>`; // Close practice-box and lesson-section
            return content;
        }

        // Generate IIT preparation content
        function generateIITContent(topic, subject, depth, profile) {
            if (profile.goal === "no") {
                return `<div class="lesson-section">
                    <h2 class="lesson-title">IIT/JEE Preparation</h2>
                    <p>You haven't selected IIT preparation as a goal. Enable it in your profile to unlock this content.</p>
                </div>`;
            }
            
            let content = `<div class="lesson-section">
                <h2 class="lesson-title">IIT/JEE Preparation - ${topic}</h2>
                <div class="iit-box">
                    <h3>JEE Importance</h3>`;
            
            if (topic === "e=mc2") {
                content += `<p>This concept is crucial for:</p>
                <ul>
                    <li>Modern physics section (5-6 questions in JEE Main)</li>
                    <li>Nuclear physics problems</li>
                    <li>Mass-energy conversion calculations</li>
                    <li>Photon energy and particle physics</li>
                </ul>
                <p>Expected questions: 1-2 in JEE Main, potentially more in JEE Advanced</p>`;
            } else if (topic === "Motion") {
                content += `<p>This fundamental concept appears in:</p>
                <ul>
                    <li>Kinematics problems (3-4 questions in JEE Main)</li>
                    <li>Projectile motion</li>
                    <li>Relative motion concepts</li>
                    <li>As basis for dynamics and other advanced topics</li>
                </ul>
                <p>Expected questions: 2-3 in JEE Main, often combined with other concepts in JEE Advanced</p>`;
            } else if (topic === "Gravitation") {
                content += `<p>This concept is important for:</p>
                <ul>
                    <li>Gravitation problems (2-3 questions in JEE Main)</li>
                    <li>Orbital mechanics</li>
                    <li>Kepler's laws applications</li>
                    <li>Escape velocity calculations</li>
                </ul>`;
            } else {
                content += `<p>This topic may appear in JEE depending on the subject and depth of coverage.</p>`;
            }
            
            content += `</div>`; // Close iit-box
            
            // Add JEE preparation strategy based on class
            content += `<div class="iit-box">
                <h3>Preparation Strategy</h3>`;
            
            if (profile.currentClass <= 10) {
                content += `<p>Since you're in Class ${profile.currentClass}, focus on:</p>
                <ul>
                    <li>Building strong conceptual understanding</li>
                    <li>Solving basic numerical problems</li>
                    <li>Developing problem-solving approach</li>
                    <li>Connecting concepts to real-world applications</li>
                </ul>
                <p>Recommended resources: NCERT textbooks, Foundation books for IIT preparation</p>`;
            } else {
                content += `<p>For Class ${profile.currentClass} JEE preparation:</p>
                <ul>
                    <li>Master all derivations and concepts</li>
                    <li>Practice 20-30 problems on this topic</li>
                    <li>Solve previous year JEE questions</li>
                    <li>Time yourself - aim for 2-3 minutes per question</li>
                    <li>Analyze mistakes and weak areas</li>
                </ul>
                <p>Recommended resources: HC Verma, DC Pandey, Irodov (for advanced), previous 10 years papers</p>`;
            }
            
            content += `</div>`; // Close iit-box
            
            // Add JEE questions if relevant
            if (profile.currentClass >= 11 && (depth === "iit" || depth === "advanced")) {
                content += `<div class="iit-box">
                    <h3>JEE-Level Questions</h3>`;
                
                if (topic === "e=mc2") {
                    content += `<p><strong>JEE Main 2020:</strong> A particle of mass m at rest decays into two particles of masses m₁ and m₂ having non-zero velocities. 
                    The ratio of de-Broglie wavelengths is (a) m₁/m₂ (b) m₂/m₁ (c) 1 (d) √(m₂/m₁)</p>
                    <p><strong>Solution:</strong> (c) 1 (since momenta are equal and opposite)</p>`;
                    
                    content += `<p><strong>JEE Advanced 2019:</strong> A photon of wavelength λ is scattered by an electron initially at rest. 
                    If the photon wavelength becomes λ' after scattering, calculate the kinetic energy imparted to the electron.</p>
                    <p><strong>Solution Approach:</strong> Use energy conservation: hc/λ = hc/λ' + KE</p>`;
                } else if (topic === "Motion") {
                    content += `<p><strong>JEE Main 2021:</strong> A particle moves in straight line with velocity v = √x. What is acceleration at x=4m?</p>
                    <p><strong>Solution:</strong> a = dv/dt = (dv/dx)(dx/dt) = (1/2√x)(√x) = 0.5 m/s²</p>`;
                    
                    content += `<p><strong>JEE Advanced 2018:</strong> Two particles are projected from same point with same speed u at angles θ and (90°-θ). 
                    Show that their trajectories intersect at right angles when tanθ = √2.</p>`;
                } else if (topic === "Gravitation") {
                    content += `<p><strong>JEE Main 2019:</strong> A planet has twice the radius and eight times the mass of Earth. What is the escape velocity from its surface?</p>
                    <p><strong>Solution:</strong> v = √(2GM/R), so new v = √(2G×8M/2R) = 2×√(2GM/R) = 2×11.2 = 22.4 km/s</p>`;
                }
                
                content += `</div>`; // Close iit-box
            }
            
            // Add study plan recommendation
            content += `<div class="iit-box">
                <h3>Study Plan</h3>
                <p>Based on your ${profile.studyTime} hours daily study time:</p>
                <ul>
                    <li>Spend ${profile.currentClass <= 10 ? '30' : '60'} minutes on this topic initially</li>
                    <li>Review weekly for ${profile.currentClass <= 10 ? '15' : '30'} minutes</li>
                    <li>Solve ${profile.currentClass <= 10 ? '5-10' : '15-20'} problems weekly</li>
                    <li>Include in monthly revision tests</li>
                </ul>
                <p>Track progress and increase difficulty gradually.</p>
            </div>`;
            
            content += `</div>`; // Close lesson-section
            return content;
        }

        // Generate simulation content
        function generateSimulationContent(topic, subject, depth, profile) {
            let content = `<div class="lesson-section">
                <h2 class="lesson-title">${topic} - Simulation</h2>
                <div class="simulation-box">
                    <h3>Interactive Learning</h3>`;
            
            if (topic === "e=mc2") {
                content += `<p>Imagine a virtual particle accelerator demonstrating mass-energy conversion:</p>
                <ul>
                    <li>Particles collide at high speeds</li>
                    <li>Mass converts to energy according to E = mc²</li>
                    <li>New particles form from this energy</li>
                </ul>`;
            } else if (topic === "Motion") {
                content += `<p>Motion simulation concepts:</p>
                <ul>
                    <li>Position-time graph visualization</li>
                    <li>Velocity and acceleration vectors</li>
                    <li>Projectile motion trajectory</li>
                    <li>Relative motion examples</li>
                </ul>`;
            } else if (topic === "Gravitation") {
                content += `<p>Gravitation simulation concepts:</p>
                <ul>
                    <li>Planetary orbits visualization</li>
                    <li>Gravity well representation</li>
                    <li>Escape velocity demonstration</li>
                    <li>Tidal forces explanation</li>
                </ul>`;
            } else {
                content += `<p>Interactive simulation for ${topic} concepts.</p>`;
            }
            
            // Add simulation parameters based on profile
            content += `<div class="simulation-box">
                <h4>Simulation Parameters</h4>
                <p>Customized for your level (Class ${profile.currentClass}, ${profile.currentMarks}% marks):</p>`;
            
            if (profile.currentMarks < 50) {
                content += `<p>Basic simulation showing fundamental concepts</p>`;
            } else if (profile.currentMarks < 70) {
                content += `<p>Intermediate simulation with numerical displays</p>`;
            } else {
                content += `<p>Advanced simulation with multiple variables</p>`;
            }
            
            if (profile.learningStyle === "visual") {
                content += `<p>Visual mode active - emphasizing graphs and animations</p>`;
            } else if (profile.learningStyle === "kinesthetic") {
                content += `<p>Interactive mode - adjust parameters to see changes</p>`;
            }
            
            // Add drone reference if relevant
            if (profile.interests.includes("Drones") && shouldShowDrone(topic, subject)) {
                content += `<p>The flying drone demonstrates ${topic} concepts in action!</p>`;
            }
            
            content += `</div>
                <p id="simulationStatus">Initializing simulation... <span class="loading">Please wait</span></p>
                <div id="simulationResults"></div>
            </div></div>`; // Close simulation-box and lesson-section
            
            // Start simulation after a delay
            setTimeout(() => {
                document.getElementById('simulationStatus').innerHTML = "Simulation ready!";
                
                if (shouldShowDrone(topic, subject)) {
                    document.getElementById('simulationStatus').innerHTML += " Watch the drone animation.";
                    const drone = document.getElementById("drone");
                    drone.style.display = "block";
                }
                
                setTimeout(() => {
                    document.getElementById('simulationResults').innerHTML = 
                        `<p>Simulation complete! Here's what happened:</p>
                        <ul>
                            <li>Concept demonstrated: ${topic}</li>
                            <li>Duration: 3 seconds</li>
                            <li>Learning points reinforced: ${Math.floor(Math.random()*3)+2}</li>
                        </ul>`;
                    const drone = document.getElementById("drone");
                    if (drone.style.display === "block") {
                        drone.style.display = "none";
                    }
                }, 3000);
            }, 2000);
            
            return content;
        }

        // Fetch topic info from Wikipedia
        async function fetchTopicInfo(topic) {
            if (!navigator.onLine) return "Internet connection required for additional information.";
            try {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`);
                const data = await response.json();
                return data.extract || "No additional information available.";
            } catch (e) {
                return "Couldn't fetch additional information.";
            }
        }

        // Initialize with default profile if none exists
        if (!localStorage.getItem("studentProfile")) {
            const defaultProfile = {
                currentClass: "11",
                currentMarks: 75,
                strengths: ["Maths", "Chemistry"],
                weaknesses: ["Physics", "Biology"],
                learningStyle: "visual",
                interests: ["Drones", "Robotics", "Space"],
                goal: "serious",
                studyTime: "3"
            };
            localStorage.setItem("studentProfile", JSON.stringify(defaultProfile));
        }
    </script>
</body>
</html>
